{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/dan/Documents/prueba_useit/mini_chat_grupal/frontend/mini_chat/src/ChatRoom.js\";\nimport React, { Component } from 'react';\nimport ReactDOM, { unmountComponentAtNode } from 'react-dom';\nimport styles from './ChatRoom.module.css';\nexport default class ChatRoom extends Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Hello\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 8,\n      columnNumber: 4\n    }, this);\n  }\n\n}\nlet roomId = 'undefined';\nlet imgB64String;\n\nwindow.onload = function () {\n  const logout = document.querySelector('.logout');\n  logout.addEventListener('click', function () {\n    window.location.replace('/login');\n  });\n  const addRoom = document.querySelector('#rooms button');\n  addRoom.addEventListener('click', async function (evn) {\n    createRoom();\n  });\n  const changeRoom = document.querySelector('.change_room');\n  const deleteRoombtn = document.querySelector('.delete_room');\n  const nameRoombtn = document.querySelector('.room_name');\n  changeRoom.addEventListener('click', async function () {\n    renderRooms(await getRooms());\n    document.querySelector('#users').style.display = 'none';\n    document.querySelector('#chat').style.display = 'none';\n    changeRoom.style.display = 'none';\n    deleteRoombtn.style.display = 'none';\n    nameRoombtn.style.display = 'none';\n  });\n  deleteRoombtn.addEventListener('click', async function () {\n    const conf = confirm('Are you sure about deleting this Room?');\n\n    if (conf) {\n      await deleteRoom();\n      await renderRooms(await getRooms());\n      document.querySelector('#users').style.display = 'none';\n      document.querySelector('#chat').style.display = 'none';\n      changeRoom.style.display = 'none';\n      deleteRoombtn.style.display = 'none';\n      nameRoombtn.style.display = 'none';\n    }\n  });\n  nameRoombtn.querySelector('h1').addEventListener('click', function (evn) {\n    nameRoombtn.querySelector('input').style.display = 'block';\n    nameRoombtn.querySelector('input').value = evn.target.innerHTML;\n    nameRoombtn.querySelector('input').focus();\n  });\n  nameRoombtn.querySelector('input').addEventListener('keyup', async function (evn) {\n    if (evn.keyCode === 13) {\n      await saveRoomName(evn.target.value);\n      evn.target.style.display = 'none';\n      nameRoombtn.querySelector('h1').innerHTML = evn.target.value;\n      evn.target.value = ''; // evn.target.blur();\n    }\n  });\n  nameRoombtn.querySelector('input').addEventListener('focusout', function (evn) {\n    evn.target.style.display = 'none';\n  });\n  setRoomsListeners();\n  const editor = document.querySelector('.edit_container');\n  editor.querySelector('button').addEventListener('click', async function () {\n    const messageInput = editor.querySelector('textarea');\n    console.log(messageInput.value);\n    console.log('Send message');\n\n    if (messageInput.value !== '') {\n      await sendMessage(messageInput.value);\n      messageInput.value = '';\n    }\n  });\n  editor.querySelector('div').addEventListener('click', function (evn) {\n    editor.querySelector('input').click();\n  });\n  editor.querySelector('input').addEventListener('change', function (evn) {\n    if (evn.target.files && evn.target.files.length > 0) {\n      const file = evn.target.files[0];\n      renderImageUploader(file, document.querySelector('.uploader img'));\n    }\n\n    evn.target.value = '';\n    document.querySelector('.uploader').style.display = 'block';\n  });\n  document.querySelector('.uploader h2').addEventListener('click', function () {\n    document.querySelector('.uploader').style.display = 'none';\n  });\n  document.querySelector('.uploader button').addEventListener('click', async function (evn) {\n    console.log('uploade image');\n    await uploadImage('message'); // console.log(roomId);\n\n    loadMessages();\n    document.querySelector('.uploader').style.display = 'none';\n  });\n  const profilePic = document.querySelector('.profile_pic');\n  profilePic.addEventListener('mousemove', function () {\n    profilePic.querySelector('.change_photo').style.display = 'block';\n  });\n  profilePic.addEventListener('mouseleave', function () {\n    profilePic.querySelector('.change_photo').style.display = 'none';\n  });\n  profilePic.querySelector('.change_photo').addEventListener('click', function () {\n    profilePic.querySelector('.change_photo input').click();\n  });\n  profilePic.querySelector('.change_photo input').addEventListener('change', function (evn) {\n    if (evn.target.files && evn.target.files.length > 0) {\n      const file = evn.target.files[0];\n      renderImageUploader(file, document.querySelector('.profile img'));\n    }\n\n    evn.target.value = '';\n    document.querySelector('.profile').style.display = 'block';\n  });\n  document.querySelector('.profile h2').addEventListener('click', function () {\n    document.querySelector('.profile').style.display = 'none';\n  });\n  document.querySelector('.profile button').addEventListener('click', async function (evn) {\n    console.log('uploade image');\n    await uploadImage('profile');\n    fetchMedia('profile', {\n      object: profilePic.querySelector('img'),\n      id: 0\n    });\n\n    if (roomId !== 'undefined') {\n      await getUsers(roomId);\n    }\n\n    document.querySelector('.profile').style.display = 'none';\n  });\n  fetchMedia('profile', {\n    object: profilePic.querySelector('img'),\n    id: 0\n  });\n  const profileName = document.querySelector('.profile_name');\n  profileName.querySelector('h1').addEventListener('click', function (evn) {\n    profileName.querySelector('input').style.display = 'block';\n    profileName.querySelector('input').value = evn.target.innerHTML;\n    profileName.querySelector('input').focus();\n  });\n  profileName.querySelector('input').addEventListener('keypress', async function (evn) {\n    if (evn.keyCode === 13) {\n      await saveUsername(evn.target.value);\n      console.log('save username: ', evn.target.value);\n      evn.target.style.display = 'none';\n      profileName.querySelector('h1').innerHTML = evn.target.value;\n\n      if (roomId != 'undefined') {\n        await getUsers(roomId);\n      }\n    }\n  });\n  profileName.querySelector('input').addEventListener('focusout', async function (evn) {\n    evn.target.style.display = 'none';\n    profileName.querySelector('h1').innerHTML = evn.target.value;\n    await saveUsername(evn.target.value);\n  });\n};\n\nasync function saveUsername(username) {\n  const req = await fetch(`http://localhost:8000/users`, {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    },\n    body: JSON.stringify({\n      'username': username\n    })\n  }); // console.log(await req.json());\n\n  if (req.status === 200) {\n    const res = await req.json();\n    console.log(res);\n  }\n}\n\nasync function createRoom() {\n  console.log(localStorage.getItem('token'));\n  const req = await fetch(`http://localhost:8000/rooms`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  }); // console.log(await req.json());\n\n  if (req.status === 200) {\n    const res = await req.json();\n    renderRoom(res.id, res.name);\n  }\n}\n\nasync function saveRoomName(name) {\n  console.log(name);\n  const req = await fetch(`http://localhost:8000/rooms`, {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    },\n    body: JSON.stringify({\n      name: name,\n      id: roomId\n    })\n  });\n}\n\nasync function getRooms() {\n  console.log('getRooms');\n  const req = await fetch(`http://localhost:8000/rooms`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n\n  if (req.status === 200) {\n    const res = await req.json();\n    console.log(res);\n    return res.rooms;\n  } else {\n    console.log(req);\n    return {};\n  }\n}\n\nasync function renderRooms(rooms) {\n  console.log(rooms);\n  const roomsEl = document.getElementById('rooms');\n  const ul = roomsEl.querySelector('ul');\n  ul.innerHTML = '';\n\n  for (const room of rooms) {\n    const li = document.createElement('li');\n    li.setAttribute('room_id', room.id);\n    li.innerHTML = room.name;\n    ul.appendChild(li);\n  }\n\n  setTimeout(function () {\n    roomsEl.style.display = 'block';\n    setRoomsListeners();\n  }, 100);\n}\n\nasync function deleteRoom() {\n  console.log('delete rooms');\n  const req = await fetch(`http://localhost:8000/rooms/${roomId}/`, {\n    method: 'DELETE',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n\n  if (req.status === 200) {\n    const res = await req.json();\n    console.log(res);\n  } else {}\n}\n\nfunction setRoomsListeners() {\n  const rooms = document.querySelectorAll('#rooms li');\n\n  for (const room of rooms) {\n    room.addEventListener('click', function (evn) {\n      renderRoom(evn.target.getAttribute('room_id'), evn.target.innerHTML);\n    });\n  }\n}\n\nasync function renderRoom(id, name) {\n  roomId = id;\n  const changeRoom = document.querySelector('.change_room');\n  changeRoom.style.display = 'block';\n  const deleteRoom = document.querySelector('.delete_room');\n  deleteRoom.style.display = 'block';\n  const nameRoom = document.querySelector('.room_name');\n  nameRoom.style.display = 'block';\n  console.log('Render room');\n  console.log(name);\n  document.querySelector('.room_name h1').innerHTML = name;\n  document.getElementById('rooms').style.display = 'none';\n  console.log(id);\n  await getUsers(id);\n  document.getElementById('chat').style.display = 'block';\n  await loadMessages();\n}\n\nasync function uploadImage(type) {\n  const req = await fetch(`http://localhost:8000/media/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    },\n    body: JSON.stringify({\n      data: imgB64String,\n      type: type,\n      roomId: roomId\n    })\n  });\n  const res = await req.json();\n  console.log(res);\n  return res;\n}\n\nasync function renderImageUploader(file, img) {\n  const readHandler = async function (evn) {\n    let data = '';\n    let bytes = new Uint8Array(evn.target.result);\n    let length = bytes.byteLength;\n\n    for (let i = 0; i < length; i++) {\n      data += String.fromCharCode(bytes[i]);\n    }\n\n    data = window.btoa(data);\n    imgB64String = data;\n    img.src = `data:image/png;base64,${data}`;\n  };\n\n  let r = new FileReader();\n  let blob = file.slice(0, file.size);\n  r.onload = readHandler;\n  r.readAsArrayBuffer(blob);\n}\n\nasync function sendMessage(message) {\n  const req = await fetch(`http://localhost:8000/rooms/${roomId}/messages/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    },\n    body: JSON.stringify({\n      content: message\n    })\n  });\n\n  if (req.status === 200) {\n    loadMessages();\n  }\n}\n\nasync function loadMessages() {\n  const req = await fetch(`http://localhost:8000/rooms/${roomId}/messages`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n  console.log(req.status);\n  const res = await req.json();\n  renderMessages(res.messages, res.id);\n  console.log(res);\n}\n\nasync function renderMessages(messages, id) {\n  const ul = document.querySelector('#messages');\n  ul.innerHTML = '';\n  const first = document.createElement('li');\n  first.innerHTML = '<h1>Welcome and Hi!!, start talking with your peers</h1>';\n  first.classList.add('first');\n  ul.appendChild(first);\n\n  for (const message of messages) {\n    const mId = message.id;\n    const li = document.createElement('li');\n    let menu = '';\n    let mine = '';\n    let owner = message.user;\n\n    if (id === message.user_id) {\n      li.classList.add('mine');\n      owner = 'me';\n      menu = `\n\t\t\t\t\t<div option=\"delete\"></div>\n\t\t\t\t\t<div menu=\"message\">\n\t\t\t\t\t\t<h1></h1>\n\t\t\t\t\t\t<h2 user_id=\"${id}\">Delete Message</h2>\n\t\t\t\t\t</div>`;\n      mine = 'mine';\n    }\n\n    let media = '';\n\n    if (message.media) {\n      media = `<img>`;\n    }\n\n    const date = new Date(message.created_at).toISOString().split('T')[1].slice(0, 5);\n    li.innerHTML = `<div cont=\"message\">\n\t\t\t\t\t${menu}\n\t\t\t\t\t<h3>${owner}</h3>\n\t\t\t\t\t${media}\n\t\t\t\t\t<p>${message.content}</p>\n\t\t\t\t\t<h4>${date}</h4>\n\t\t\t\t\t</div>`;\n\n    if (id === message.user_id) {\n      const optionBtn = li.querySelector('[option=\"delete\"]');\n      optionBtn.addEventListener('click', function (evn) {\n        li.querySelector('[menu=\"message\"]').style.display = 'block';\n      });\n      const closeBtn = li.querySelector('[menu=\"message\"] h1');\n      closeBtn.addEventListener('click', function (evn) {\n        li.querySelector('[menu=\"message\"]').style.display = 'none';\n      });\n      const deleteBtn = li.querySelector('[menu=\"message\"] h2');\n      deleteBtn.addEventListener('click', function (evn) {\n        const messageId = message.id;\n        const conf = confirm('Are you sure about deleting this message?');\n\n        if (conf) {\n          removeMessage(messageId);\n        } else {\n          li.querySelector('[menu=\"message\"]').style.display = 'none';\n        } // li.querySelector('[menu=\"message\"]').style.display = 'none';\n\n      });\n    }\n\n    ul.appendChild(li);\n\n    if (message.media) {\n      const img = li.querySelector('img');\n      const obj = {\n        id: message.id,\n        object: img\n      };\n      await fetchMedia('message', Object.assign({}, obj));\n    }\n  }\n\n  setTimeout(function () {\n    const lastIndex = ul.querySelectorAll('li').length - 1;\n    const lastLi = ul.querySelectorAll('li')[lastIndex]; // console.log(lastLi.offsetTop, ul.scrollTop, ul.scrollHeight);\n\n    ul.scrollTop = ul.scrollHeight;\n  }, 200); // lastLi.scrollTop = ul.scrollHeight;\n  // ul.scrollTop = ul.scrollHeight;\n  // lastLi.focus();\n  // lastLi.scrollIntoView(false);\n}\n\nasync function fetchMedia(type, obj) {\n  const req = await fetch(`http://localhost:8000/media/${obj.id}?type=${type}`, {\n    method: 'GET',\n    headers: {\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n  const res = await req.blob();\n  obj.object.src = window.URL.createObjectURL(res); // console.log(res);\n}\n\nasync function removeMessage(messageId) {\n  const req = await fetch(`http://localhost:8000/messages/${messageId}/`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n  const res = await req.json();\n  console.log(res);\n  loadMessages();\n}\n\nasync function getUsers(id) {\n  console.log(id);\n  const req = await fetch(`http://localhost:8000/rooms/${id}/users`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Token ${localStorage.getItem('token')}`\n    }\n  });\n  const res = await req.json();\n  console.log(res);\n  document.getElementById('users').style.display = 'block';\n  renderUsers(res.users);\n}\n\nfunction renderUsers(users) {\n  const cont = document.querySelector('#users ul');\n  cont.innerHTML = '';\n\n  for (const user of users) {\n    const li = document.createElement('li');\n    const time = `${user.last_login.split('T')[1].split('.')[0]}`;\n    const date = `${user.last_login.split('T')[0]}`;\n    li.innerHTML = `<img><h1>${user.username}</h1><h2>Last login: ${time} / ${date}</h2>`;\n    cont.appendChild(li);\n    fetchMedia('profile', {\n      object: li.querySelector('img'),\n      id: user.id\n    });\n  }\n}","map":{"version":3,"sources":["/home/dan/Documents/prueba_useit/mini_chat_grupal/frontend/mini_chat/src/ChatRoom.js"],"names":["React","Component","ReactDOM","unmountComponentAtNode","styles","ChatRoom","render","roomId","imgB64String","window","onload","logout","document","querySelector","addEventListener","location","replace","addRoom","evn","createRoom","changeRoom","deleteRoombtn","nameRoombtn","renderRooms","getRooms","style","display","conf","confirm","deleteRoom","value","target","innerHTML","focus","keyCode","saveRoomName","setRoomsListeners","editor","messageInput","console","log","sendMessage","click","files","length","file","renderImageUploader","uploadImage","loadMessages","profilePic","fetchMedia","object","id","getUsers","profileName","saveUsername","username","req","fetch","method","headers","localStorage","getItem","body","JSON","stringify","status","res","json","renderRoom","name","rooms","roomsEl","getElementById","ul","room","li","createElement","setAttribute","appendChild","setTimeout","querySelectorAll","getAttribute","nameRoom","type","data","img","readHandler","bytes","Uint8Array","result","byteLength","i","String","fromCharCode","btoa","src","r","FileReader","blob","slice","size","readAsArrayBuffer","message","content","renderMessages","messages","first","classList","add","mId","menu","mine","owner","user","user_id","media","date","Date","created_at","toISOString","split","optionBtn","closeBtn","deleteBtn","messageId","removeMessage","obj","Object","assign","lastIndex","lastLi","scrollTop","scrollHeight","URL","createObjectURL","renderUsers","users","cont","time","last_login"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM, { unmountComponentAtNode } from 'react-dom';\nimport styles from './ChatRoom.module.css';\n\nexport default class ChatRoom extends Component {\n\trender () {\n\t\treturn(\n\t\t\t<h1>Hello</h1>\n\t\t);\n\t}\n}\n\n\n\n\n\n\n\n\n\n\n\nlet roomId = 'undefined';\nlet imgB64String;\nwindow.onload = function () {\n\t\n\tconst logout = document.querySelector('.logout');\n\tlogout.addEventListener('click', function () {\n\t\twindow.location.replace('/login');\n\t});\n\tconst addRoom = document.querySelector('#rooms button');\n\taddRoom.addEventListener('click', async function (evn) {\n\t\tcreateRoom();\n\t});\n\tconst changeRoom = document.querySelector('.change_room');\n\tconst deleteRoombtn = document.querySelector('.delete_room');\n\tconst nameRoombtn = document.querySelector('.room_name');\n\tchangeRoom.addEventListener('click', async function () {\n\t\trenderRooms(await getRooms());\n\t\tdocument.querySelector('#users').style.display = 'none';\n\t\tdocument.querySelector('#chat').style.display = 'none';\n\t\tchangeRoom.style.display = 'none';\n\t\tdeleteRoombtn.style.display = 'none';\n\t\tnameRoombtn.style.display = 'none';\n\t});\n\tdeleteRoombtn.addEventListener('click', async function () {\n\t\tconst conf = confirm('Are you sure about deleting this Room?');\n\t\tif (conf) {\n\t\t\tawait deleteRoom();\n\t\t\tawait renderRooms(await getRooms());\n\t\t\tdocument.querySelector('#users').style.display = 'none';\n\t\t\tdocument.querySelector('#chat').style.display = 'none';\n\t\t\tchangeRoom.style.display = 'none';\n\t\t\tdeleteRoombtn.style.display = 'none';\n\t\t\tnameRoombtn.style.display = 'none';\n\t\t}\n\t});\n\tnameRoombtn.querySelector('h1').addEventListener('click', function (evn) {\n\t\tnameRoombtn.querySelector('input').style.display = 'block';\n\t\tnameRoombtn.querySelector('input').value = evn.target.innerHTML;\n\t\tnameRoombtn.querySelector('input').focus();\n\t});\n\tnameRoombtn.querySelector('input').addEventListener('keyup', async function (evn) {\n\t\tif (evn.keyCode === 13) {\n\t\t\tawait saveRoomName(evn.target.value);\n\t\t\tevn.target.style.display = 'none';\n\t\t\tnameRoombtn.querySelector('h1').innerHTML = evn.target.value;\n\t\t\tevn.target.value = '';\n\t\t\t// evn.target.blur();\n\t\t}\n\t});\n\tnameRoombtn.querySelector('input').addEventListener('focusout', function (evn) {\n\t\tevn.target.style.display = 'none';\n\t});\n\tsetRoomsListeners();\n\tconst editor = document.querySelector('.edit_container');\n\teditor.querySelector('button').addEventListener('click', async function () {\n\t\tconst messageInput = editor.querySelector('textarea');\n\t\tconsole.log(messageInput.value);\n\t\tconsole.log('Send message');\n\t\tif (messageInput.value !== '') {\n\t\t\tawait sendMessage(messageInput.value);\n\t\t\tmessageInput.value = '';\n\t\t}\n\t});\n\teditor.querySelector('div').addEventListener('click', function (evn) {\n\t\teditor.querySelector('input').click();\n\t});\n\teditor.querySelector('input').addEventListener('change', function (evn) {\n\t\tif (evn.target.files && evn.target.files.length > 0) {\n\t\t\tconst file = evn.target.files[0];\n\t\t\trenderImageUploader(file, document.querySelector('.uploader img'));\n\t\t}\n\t\tevn.target.value = '';\n\t\tdocument.querySelector('.uploader').style.display = 'block';\n\t});\n\tdocument.querySelector('.uploader h2').addEventListener('click', function () {\n\t\tdocument.querySelector('.uploader').style.display = 'none';\n\t});\n\tdocument.querySelector('.uploader button').addEventListener('click', async function (evn) {\n\t\tconsole.log('uploade image');\n\t\tawait uploadImage('message');\n\t\t// console.log(roomId);\n\t\tloadMessages();\n\t\tdocument.querySelector('.uploader').style.display = 'none';\n\t});\n\tconst profilePic = document.querySelector('.profile_pic');\n\tprofilePic.addEventListener('mousemove', function () {\n\t\tprofilePic.querySelector('.change_photo').style.display = 'block';\n\t});\n\tprofilePic.addEventListener('mouseleave', function () {\n\t\tprofilePic.querySelector('.change_photo').style.display = 'none';\n\t});\n\tprofilePic.querySelector('.change_photo').addEventListener('click', function () {\n\t\tprofilePic.querySelector('.change_photo input').click();\n\t});\n\tprofilePic.querySelector('.change_photo input').addEventListener('change', function (evn) {\n\t\tif (evn.target.files && evn.target.files.length > 0) {\n\t\t\tconst file = evn.target.files[0];\n\t\t\trenderImageUploader(file, document.querySelector('.profile img'));\n\t\t}\n\t\tevn.target.value = '';\n\t\tdocument.querySelector('.profile').style.display = 'block';\n\t});\n\tdocument.querySelector('.profile h2').addEventListener('click', function () {\n\t\tdocument.querySelector('.profile').style.display = 'none';\n\t});\n\tdocument.querySelector('.profile button').addEventListener('click', async function (evn) {\n\t\tconsole.log('uploade image');\n\t\tawait uploadImage('profile');\n\t\tfetchMedia('profile', {\n\t\t\tobject: profilePic.querySelector('img'),\n\t\t\tid: 0\n\t\t})\n\t\tif (roomId !== 'undefined') {\n\t\t\tawait getUsers(roomId);\n\t\t}\n\t\tdocument.querySelector('.profile').style.display = 'none';\n\t});\n\tfetchMedia('profile', {\n\t\tobject: profilePic.querySelector('img'),\n\t\tid: 0\n\t});\n\tconst profileName = document.querySelector('.profile_name');\n\tprofileName.querySelector('h1').addEventListener('click', function (evn) {\n\t\tprofileName.querySelector('input').style.display = 'block';\n\t\tprofileName.querySelector('input').value = evn.target.innerHTML;\n\t\tprofileName.querySelector('input').focus();\n\t});\n\tprofileName.querySelector('input').addEventListener('keypress', async function (evn) {\n\t\tif (evn.keyCode === 13) {\n\t\t\tawait saveUsername(evn.target.value)\n\t\t\tconsole.log('save username: ', evn.target.value);\n\t\t\tevn.target.style.display = 'none';\n\t\t\tprofileName.querySelector('h1').innerHTML = evn.target.value;\n\t\t\tif (roomId != 'undefined') {\n\t\t\t\tawait getUsers(roomId);\n\t\t\t}\n\n\t\t}\n\t});\n\tprofileName.querySelector('input').addEventListener('focusout', async function (evn) {\n\t\tevn.target.style.display = 'none';\n\t\tprofileName.querySelector('h1').innerHTML = evn.target.value;\n\t\tawait saveUsername(evn.target.value)\n\t});\n}\nasync function saveUsername (username) {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/users`,\n\t\t{\n\t\t\tmethod: 'PUT',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\t'username': username\n\t\t\t})\n\t\t}\n\t);\n\t// console.log(await req.json());\n\tif (req.status === 200) {\n\t\tconst res = await req.json();\n\t\tconsole.log(res);\n\t}\n}\nasync function createRoom () {\n\tconsole.log(localStorage.getItem('token'));\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms`,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\t// console.log(await req.json());\n\tif (req.status === 200) {\n\t\tconst res = await req.json();\n\t\trenderRoom(res.id, res.name);\n\t}\n}\nasync function saveRoomName (name) {\n\tconsole.log(name);\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms`,\n\t\t{\n\t\t\tmethod: 'PUT',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\tname: name,\n\t\t\t\tid: roomId\n\t\t\t})\n\t\t}\n\t);\n}\nasync function getRooms () {\n\tconsole.log('getRooms');\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms`,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tif (req.status === 200) {\n\t\tconst res = await req.json();\n\t\tconsole.log(res);\n\t\treturn res.rooms;\n\t} else {\n\t\tconsole.log(req);\n\t\treturn {};\n\t}\n}\nasync function renderRooms (rooms) {\n\tconsole.log(rooms);\n\tconst roomsEl = document.getElementById('rooms');\n\tconst ul = roomsEl.querySelector('ul');\n\tul.innerHTML = '';\n\tfor (const room of rooms) {\n\t\tconst li = document.createElement('li');\n\t\tli.setAttribute('room_id', room.id);\n\t\tli.innerHTML = room.name;\n\t\tul.appendChild(li);\n\t}\n\tsetTimeout(function () {\n\t\troomsEl.style.display = 'block';\n\t\tsetRoomsListeners();\n\t}, 100);\n\t\n}\nasync function deleteRoom () {\n\tconsole.log('delete rooms');\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms/${roomId}/`,\n\t\t{\n\t\t\tmethod: 'DELETE',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tif (req.status === 200) {\n\t\tconst res = await req.json();\n\t\tconsole.log(res);\n\t} else {\n\t\t\n\t}\n}\nfunction setRoomsListeners () {\n\tconst rooms = document.querySelectorAll('#rooms li');\n\tfor (const room of rooms) {\n\t\troom.addEventListener('click', function (evn) {\n\t\t\trenderRoom(evn.target.getAttribute('room_id'), evn.target.innerHTML);\n\t\t});\n\t}\n}\nasync function renderRoom (id, name) {\n\troomId = id;\n\tconst changeRoom = document.querySelector('.change_room');\n\tchangeRoom.style.display = 'block';\n\tconst deleteRoom = document.querySelector('.delete_room');\n\tdeleteRoom.style.display = 'block';\n\tconst nameRoom = document.querySelector('.room_name');\n\tnameRoom.style.display = 'block';\n\tconsole.log('Render room');\n\tconsole.log(name)\n\tdocument.querySelector('.room_name h1').innerHTML = name;\n\tdocument.getElementById('rooms').style.display = 'none';\n\tconsole.log(id);\n\tawait getUsers(id);\n\tdocument.getElementById('chat').style.display = 'block';\n\tawait loadMessages();\n}\nasync function uploadImage (type) {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/media/`,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\tdata: imgB64String,\n\t\t\t\ttype: type,\n\t\t\t\troomId: roomId\n\t\t\t})\n\t\t}\n\t);\n\tconst res = await req.json();\n\tconsole.log(res);\n\treturn res;\n}\nasync function renderImageUploader (file, img) {\n\tconst readHandler = async function (evn) {\n\t\tlet data = '';\n\t\tlet bytes = new Uint8Array(evn.target.result);\n\t\tlet length = bytes.byteLength;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tdata += String.fromCharCode(bytes[i])\n\t\t}\n\t\tdata = window.btoa(data);\n\t\timgB64String = data;\n\t\timg.src = `data:image/png;base64,${data}`;\n\t}\n\tlet r = new FileReader();\n\tlet blob = file.slice(0, file.size);\n\tr.onload = readHandler;\n\tr.readAsArrayBuffer(blob);\n}\nasync function sendMessage (message) {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms/${roomId}/messages/`,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\tcontent: message\n\t\t\t})\n\t\t}\n\t);\n\tif (req.status === 200) {\n\t\tloadMessages();\n\t}\n\n}\nasync function loadMessages () {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms/${roomId}/messages`,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tconsole.log(req.status);\n\tconst res = await req.json();\n\trenderMessages(res.messages, res.id);\n\tconsole.log(res);\n}\nasync function renderMessages (messages, id) {\n\tconst ul = document.querySelector('#messages');\n\tul.innerHTML = '';\n\tconst first = document.createElement('li');\n\tfirst.innerHTML = '<h1>Welcome and Hi!!, start talking with your peers</h1>';\n\tfirst.classList.add('first');\n\tul.appendChild(first);\n\tfor (const message of messages) {\n\t\tconst mId = message.id;\n\t\tconst li = document.createElement('li');\n\t\tlet menu = '';\n\t\tlet mine = '';\n\t\tlet owner = message.user\n\t\tif (id === message.user_id) {\n\t\t\tli.classList.add('mine');\n\t\t\towner = 'me'\n\t\t\tmenu = `\n\t\t\t\t\t<div option=\"delete\"></div>\n\t\t\t\t\t<div menu=\"message\">\n\t\t\t\t\t\t<h1></h1>\n\t\t\t\t\t\t<h2 user_id=\"${id}\">Delete Message</h2>\n\t\t\t\t\t</div>`;\n\t\t\tmine = 'mine';\n\t\t}\n\t\tlet media = '';\n\t\tif (message.media) {\n\t\t\tmedia = `<img>`\n\t\t}\n\t\tconst date = new Date(message.created_at).toISOString().split('T')[1].slice(0, 5);\n\t\tli.innerHTML = `<div cont=\"message\">\n\t\t\t\t\t${menu}\n\t\t\t\t\t<h3>${owner}</h3>\n\t\t\t\t\t${media}\n\t\t\t\t\t<p>${message.content}</p>\n\t\t\t\t\t<h4>${date}</h4>\n\t\t\t\t\t</div>`;\n\t\tif (id === message.user_id) {\n\t\t\tconst optionBtn = li.querySelector('[option=\"delete\"]');\n\t\t\toptionBtn.addEventListener('click', function (evn) {\n\t\t\t\tli.querySelector('[menu=\"message\"]').style.display = 'block';\n\t\t\t});\n\t\t\tconst closeBtn = li.querySelector('[menu=\"message\"] h1');\n\t\t\tcloseBtn.addEventListener('click', function (evn) {\n\t\t\t\tli.querySelector('[menu=\"message\"]').style.display = 'none';\n\t\t\t});\n\t\t\tconst deleteBtn = li.querySelector('[menu=\"message\"] h2');\n\t\t\tdeleteBtn.addEventListener('click', function (evn) {\n\t\t\t\tconst messageId = message.id;\n\t\t\t\tconst conf = confirm('Are you sure about deleting this message?');\n\t\t\t\tif (conf) {\n\t\t\t\t\tremoveMessage(messageId);\n\t\t\t\t} else {\n\t\t\t\t\tli.querySelector('[menu=\"message\"]').style.display = 'none';\n\t\t\t\t}\n\t\t\t\t// li.querySelector('[menu=\"message\"]').style.display = 'none';\n\t\t\t});\n\t\t}\n\t\tul.appendChild(li);\n\t\tif (message.media) {\n\t\t\tconst img = li.querySelector('img');\n\t\t\tconst obj = {id: message.id, object: img};\n\t\t\tawait fetchMedia('message', Object.assign({}, obj));\n\t\t}\n\t}\n\tsetTimeout(function () {\n\t\tconst lastIndex = ul.querySelectorAll('li').length - 1;\n\t\tconst lastLi = ul.querySelectorAll('li')[lastIndex];\n\t\t// console.log(lastLi.offsetTop, ul.scrollTop, ul.scrollHeight);\n\t\tul.scrollTop = ul.scrollHeight;\n\t}, 200);\n\t\n\t// lastLi.scrollTop = ul.scrollHeight;\n\t// ul.scrollTop = ul.scrollHeight;\n\t// lastLi.focus();\n\t// lastLi.scrollIntoView(false);\n\t\n}\nasync function fetchMedia (type, obj) {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/media/${obj.id}?type=${type}`,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tconst res = await req.blob();\n\tobj.object.src = window.URL.createObjectURL(res);\n\t// console.log(res);\n}\nasync function removeMessage (messageId) {\n\tconst req = await fetch(\n\t\t`http://localhost:8000/messages/${messageId}/`,\n\t\t{\n\t\t\tmethod: 'DELETE',\n\t\t\theaders: {\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tconst res = await req.json();\n\tconsole.log(res);\n\tloadMessages();\n}\nasync function getUsers (id) {\n\tconsole.log(id);\n\tconst req = await fetch(\n\t\t`http://localhost:8000/rooms/${id}/users`,\n\t\t{\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'Authorization': `Token ${localStorage.getItem('token')}`\n\t\t\t}\n\t\t}\n\t);\n\tconst res = await req.json();\n\tconsole.log(res);\n\tdocument.getElementById('users').style.display = 'block';\n\trenderUsers(res.users);\n}\nfunction renderUsers (users) {\n\tconst cont = document.querySelector('#users ul');\n\tcont.innerHTML = '';\n\tfor (const user of users) {\n\t\tconst li = document.createElement('li');\n\t\tconst time = `${user.last_login.split('T')[1].split('.')[0]}`;\n\t\tconst date = `${user.last_login.split('T')[0]}`;\n\t\tli.innerHTML = `<img><h1>${user.username}</h1><h2>Last login: ${time} / ${date}</h2>`;\n\t\tcont.appendChild(li);\n\t\tfetchMedia('profile', {\n\t\t\tobject: li.querySelector('img'),\n\t\t\tid: user.id\n\t\t})\n\t}\n}"]},"metadata":{},"sourceType":"module"}